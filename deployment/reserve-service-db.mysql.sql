-- MySQL database dump for reserve-service - POBLACIÓN BASE OPTIMIZADA
-- Este archivo contiene solo la estructura y datos base para funcionamiento inmediato

SET NAMES 'utf8mb4';
SET CHARACTER SET utf8mb4;

-- Crear base de datos si no existe
CREATE DATABASE IF NOT EXISTS reserve CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE reserve;

-- Eliminar tablas si existen para evitar conflictos
DROP TABLE IF EXISTS reserves_users;
DROP TABLE IF EXISTS reserves;
DROP TABLE IF EXISTS users;

-- Crear tabla de usuarios
CREATE TABLE users (
    id BIGINT NOT NULL AUTO_INCREMENT,
    rut VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    lastname VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    birthdate DATE NOT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Crear tabla de reservas
CREATE TABLE reserves (
    id BIGINT NOT NULL AUTO_INCREMENT,
    reserveday DATE NOT NULL,
    begin TIME NOT NULL,
    finish TIME NOT NULL,
    tariff_id BIGINT NOT NULL,
    final_price DOUBLE NOT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Crear tabla intermedia para la relación muchos a muchos entre reservas y usuarios
CREATE TABLE reserves_users (
    reserve_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    PRIMARY KEY (reserve_id, user_id),
    FOREIGN KEY (reserve_id) REFERENCES reserves(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ===============================================================================
-- DATOS BASE PARA FUNCIONAMIENTO INMEDIATO - 20 USUARIOS
-- ===============================================================================
INSERT INTO users (rut, name, lastname, email, birthdate) VALUES
('12345678-9', 'Juan', 'Pérez', 'juan.perez@email.com', '1990-01-15'),
('98765432-1', 'María', 'González', 'maria.gonzalez@email.com', '1985-03-22'),
('11111111-1', 'Carlos', 'López', 'carlos.lopez@email.com', '1988-07-10'),
('22222222-2', 'Ana', 'Martín', 'ana.martin@email.com', '1992-11-03'),
('33333333-3', 'Luis', 'García', 'luis.garcia@email.com', '1987-05-18'),
('44444444-4', 'Carmen', 'Ruiz', 'carmen.ruiz@email.com', '1991-08-25'),
('55555555-5', 'Pedro', 'Sánchez', 'pedro.sanchez@email.com', '1989-12-02'),
('66666666-6', 'Laura', 'Jiménez', 'laura.jimenez@email.com', '1993-04-14'),
('77777777-7', 'Miguel', 'Torres', 'miguel.torres@email.com', '1986-09-30'),
('88888888-8', 'Isabel', 'Moreno', 'isabel.moreno@email.com', '1994-02-17'),
('99999999-9', 'David', 'Herrera', 'david.herrera@email.com', '1987-06-08'),
('10101010-1', 'Sofía', 'Vázquez', 'sofia.vazquez@email.com', '1992-11-21'),
('20202020-2', 'Alejandro', 'Castro', 'alejandro.castro@email.com', '1988-03-15'),
('30303030-3', 'Elena', 'Ortega', 'elena.ortega@email.com', '1990-07-28'),
('40404040-4', 'Raúl', 'Mendoza', 'raul.mendoza@email.com', '1989-10-12'),
('50505050-5', 'Patricia', 'Silva', 'patricia.silva@email.com', '1991-01-04'),
('60606060-6', 'Fernando', 'Campos', 'fernando.campos@email.com', '1987-05-19'),
('70707070-7', 'Cristina', 'Vargas', 'cristina.vargas@email.com', '1993-08-06'),
('80808080-8', 'Roberto', 'Cruz', 'roberto.cruz@email.com', '1986-12-23'),
('90909090-9', 'Mónica', 'Reyes', 'monica.reyes@email.com', '1994-04-11');

-- ===============================================================================
-- 100 RESERVAS PARA PRUEBAS DISTRIBUIDAS EN 6 MESES
-- ===============================================================================
INSERT INTO reserves (reserveday, begin, finish, tariff_id, final_price) VALUES
-- Febrero 2025 (15 reservas)
('2025-02-01', '09:00:00', '10:00:00', 1, 25000.0),
('2025-02-01', '10:30:00', '11:30:00', 1, 25000.0),
('2025-02-01', '14:00:00', '15:00:00', 2, 30000.0),
('2025-02-02', '16:00:00', '17:00:00', 1, 25000.0),
('2025-02-02', '18:00:00', '19:00:00', 3, 35000.0),
('2025-02-03', '09:30:00', '10:30:00', 1, 25000.0),
('2025-02-03', '11:00:00', '12:00:00', 2, 30000.0),
('2025-02-04', '13:30:00', '14:30:00', 1, 25000.0),
('2025-02-04', '15:00:00', '16:00:00', 3, 35000.0),
('2025-02-05', '17:30:00', '18:30:00', 2, 30000.0),
('2025-02-08', '10:00:00', '11:00:00', 1, 25000.0),
('2025-02-08', '12:30:00', '13:30:00', 2, 30000.0),
('2025-02-09', '14:00:00', '15:00:00', 1, 25000.0),
('2025-02-09', '16:30:00', '17:30:00', 3, 35000.0),
('2025-02-10', '18:00:00', '19:00:00', 2, 30000.0),

-- Marzo 2025 (20 reservas)
('2025-03-01', '09:00:00', '10:00:00', 1, 25000.0),
('2025-03-01', '10:30:00', '11:30:00', 2, 30000.0),
('2025-03-02', '13:00:00', '14:00:00', 1, 25000.0),
('2025-03-02', '15:30:00', '16:30:00', 3, 35000.0),
('2025-03-03', '17:00:00', '18:00:00', 2, 30000.0),
('2025-03-05', '10:00:00', '11:00:00', 1, 25000.0),
('2025-03-05', '12:30:00', '13:30:00', 2, 30000.0),
('2025-03-06', '14:00:00', '15:00:00', 1, 25000.0),
('2025-03-06', '16:30:00', '17:30:00', 3, 35000.0),
('2025-03-07', '18:00:00', '19:00:00', 2, 30000.0),
('2025-03-08', '09:30:00', '10:30:00', 1, 25000.0),
('2025-03-08', '11:00:00', '12:00:00', 2, 30000.0),
('2025-03-09', '13:30:00', '14:30:00', 1, 25000.0),
('2025-03-09', '15:00:00', '16:00:00', 3, 35000.0),
('2025-03-10', '17:30:00', '18:30:00', 2, 30000.0),
('2025-03-12', '10:00:00', '11:00:00', 1, 25000.0),
('2025-03-12', '12:00:00', '13:00:00', 2, 30000.0),
('2025-03-13', '14:30:00', '15:30:00', 1, 25000.0),
('2025-03-13', '16:00:00', '17:00:00', 3, 35000.0),
('2025-03-14', '18:30:00', '19:30:00', 2, 30000.0),

-- Abril 2025 (20 reservas)
('2025-04-02', '09:00:00', '10:00:00', 1, 25000.0),
('2025-04-02', '11:30:00', '12:30:00', 2, 30000.0),
('2025-04-03', '14:00:00', '15:00:00', 1, 25000.0),
('2025-04-03', '15:30:00', '16:30:00', 3, 35000.0),
('2025-04-04', '17:00:00', '18:00:00', 2, 30000.0),
('2025-04-05', '10:30:00', '11:30:00', 1, 25000.0),
('2025-04-05', '12:00:00', '13:00:00', 2, 30000.0),
('2025-04-06', '14:30:00', '15:30:00', 1, 25000.0),
('2025-04-06', '16:00:00', '17:00:00', 3, 35000.0),
('2025-04-07', '18:30:00', '19:30:00', 2, 30000.0),
('2025-04-09', '09:00:00', '10:00:00', 1, 25000.0),
('2025-04-09', '10:30:00', '11:30:00', 2, 30000.0),
('2025-04-10', '13:00:00', '14:00:00', 1, 25000.0),
('2025-04-10', '15:30:00', '16:30:00', 3, 35000.0),
('2025-04-11', '17:00:00', '18:00:00', 2, 30000.0),
('2025-04-12', '10:00:00', '11:00:00', 1, 25000.0),
('2025-04-12', '12:30:00', '13:30:00', 2, 30000.0),
('2025-04-13', '14:00:00', '15:00:00', 1, 25000.0),
('2025-04-13', '16:30:00', '17:30:00', 3, 35000.0),
('2025-04-14', '18:00:00', '19:00:00', 2, 30000.0),

-- Mayo 2025 (20 reservas)
('2025-05-03', '09:30:00', '10:30:00', 1, 25000.0),
('2025-05-03', '11:00:00', '12:00:00', 2, 30000.0),
('2025-05-04', '13:30:00', '14:30:00', 1, 25000.0),
('2025-05-04', '15:00:00', '16:00:00', 3, 35000.0),
('2025-05-05', '17:30:00', '18:30:00', 2, 30000.0),
('2025-05-06', '10:00:00', '11:00:00', 1, 25000.0),
('2025-05-06', '12:00:00', '13:00:00', 2, 30000.0),
('2025-05-07', '14:30:00', '15:30:00', 1, 25000.0),
('2025-05-07', '16:00:00', '17:00:00', 3, 35000.0),
('2025-05-08', '18:30:00', '19:30:00', 2, 30000.0),
('2025-05-10', '09:00:00', '10:00:00', 1, 25000.0),
('2025-05-10', '11:30:00', '12:30:00', 2, 30000.0),
('2025-05-11', '14:00:00', '15:00:00', 1, 25000.0),
('2025-05-11', '15:30:00', '16:30:00', 3, 35000.0),
('2025-05-12', '17:00:00', '18:00:00', 2, 30000.0),
('2025-05-14', '10:30:00', '11:30:00', 1, 25000.0),
('2025-05-14', '12:00:00', '13:00:00', 2, 30000.0),
('2025-05-15', '14:30:00', '15:30:00', 1, 25000.0),
('2025-05-15', '16:00:00', '17:00:00', 3, 35000.0),
('2025-05-16', '18:30:00', '19:30:00', 2, 30000.0),

-- Junio 2025 (15 reservas)
('2025-06-01', '09:00:00', '10:00:00', 1, 25000.0),
('2025-06-01', '10:30:00', '11:30:00', 2, 30000.0),
('2025-06-02', '13:00:00', '14:00:00', 1, 25000.0),
('2025-06-02', '15:00:00', '16:00:00', 3, 35000.0),
('2025-06-03', '17:00:00', '18:00:00', 2, 30000.0),
('2025-06-05', '10:00:00', '11:00:00', 1, 25000.0),
('2025-06-05', '12:30:00', '13:30:00', 2, 30000.0),
('2025-06-06', '14:00:00', '15:00:00', 1, 25000.0),
('2025-06-06', '16:30:00', '17:30:00', 3, 35000.0),
('2025-06-07', '18:00:00', '19:00:00', 2, 30000.0),
('2025-06-08', '09:30:00', '10:30:00', 1, 25000.0),
('2025-06-08', '11:00:00', '12:00:00', 2, 30000.0),
('2025-06-09', '13:30:00', '14:30:00', 1, 25000.0),
('2025-06-09', '15:00:00', '16:00:00', 3, 35000.0),
('2025-06-10', '17:30:00', '18:30:00', 2, 30000.0),

-- Julio 2025 (10 reservas - mes actual)
('2025-07-01', '09:00:00', '10:00:00', 1, 25000.0),
('2025-07-01', '11:00:00', '12:00:00', 2, 30000.0),
('2025-07-02', '14:00:00', '15:00:00', 1, 25000.0),
('2025-07-02', '16:00:00', '17:00:00', 3, 35000.0),
('2025-07-03', '18:00:00', '19:00:00', 2, 30000.0),
('2025-07-05', '10:30:00', '11:30:00', 1, 25000.0),
('2025-07-05', '12:30:00', '13:30:00', 2, 30000.0),
('2025-07-06', '14:30:00', '15:30:00', 1, 25000.0),
('2025-07-06', '16:30:00', '17:30:00', 3, 35000.0),
('2025-07-07', '18:30:00', '19:30:00', 2, 30000.0);

-- ===============================================================================
-- RELACIONES USUARIO-RESERVA REALISTAS (100 asignaciones)
-- ===============================================================================
INSERT INTO reserves_users (reserve_id, user_id) VALUES
-- Febrero (reservas 1-15): Usuarios 1-15
(1, 1), (2, 2), (3, 3), (4, 4), (5, 5), (6, 6), (7, 7), (8, 8), (9, 9), (10, 10),
(11, 11), (12, 12), (13, 13), (14, 14), (15, 15),

-- Marzo (reservas 16-35): Combinaciones de usuarios
(16, 1), (16, 2), (17, 3), (18, 4), (18, 5), (19, 6), (20, 7),
(21, 8), (21, 9), (22, 10), (23, 11), (23, 12), (24, 13), (25, 14),
(26, 15), (26, 16), (27, 17), (28, 18), (28, 19), (29, 20), (30, 1),
(31, 2), (31, 3), (32, 4), (33, 5), (33, 6), (34, 7), (35, 8),

-- Abril (reservas 36-55): Variedad de usuarios
(36, 9), (36, 10), (37, 11), (38, 12), (38, 13), (39, 14), (40, 15),
(41, 16), (41, 17), (42, 18), (43, 19), (43, 20), (44, 1), (45, 2),
(46, 3), (46, 4), (47, 5), (48, 6), (48, 7), (49, 8), (50, 9),
(51, 10), (51, 11), (52, 12), (53, 13), (53, 14), (54, 15), (55, 16),

-- Mayo (reservas 56-75): Distribución equilibrada
(56, 17), (56, 18), (57, 19), (58, 20), (58, 1), (59, 2), (60, 3),
(61, 4), (61, 5), (62, 6), (63, 7), (63, 8), (64, 9), (65, 10),
(66, 11), (66, 12), (67, 13), (68, 14), (68, 15), (69, 16), (70, 17),
(71, 18), (71, 19), (72, 20), (73, 1), (73, 2), (74, 3), (75, 4),

-- Junio (reservas 76-90): Últimas asignaciones
(76, 5), (76, 6), (77, 7), (78, 8), (78, 9), (79, 10), (80, 11),
(81, 12), (81, 13), (82, 14), (83, 15), (83, 16), (84, 17), (85, 18),
(86, 19), (86, 20), (87, 1), (88, 2), (88, 3), (89, 4), (90, 5),

-- Julio (reservas 91-100): Mes actual
(91, 6), (91, 7), (92, 8), (93, 9), (93, 10), (94, 11), (95, 12),
(96, 13), (96, 14), (97, 15), (98, 16), (98, 17), (99, 18), (100, 19), (100, 20);

-- ===============================================================================
-- ÍNDICES PARA PERFORMANCE OPTIMIZADA - RF5, RF7, RF8
-- ===============================================================================
CREATE INDEX idx_reserves_reserveday ON reserves(reserveday);
CREATE INDEX idx_reserves_date_time ON reserves(reserveday, begin, finish);
CREATE INDEX idx_reserves_tariff_price ON reserves(tariff_id, final_price);
CREATE INDEX idx_reserves_users_composite ON reserves_users(reserve_id, user_id);
CREATE INDEX idx_reserves_users_user_lookup ON reserves_users(user_id);

-- ===============================================================================
-- VERIFICACIÓN DE DATOS INSERTADOS
-- ===============================================================================
SELECT 'USUARIOS INSERTADOS:' as info, COUNT(*) as total FROM users;
SELECT 'RESERVAS INSERTADAS:' as info, COUNT(*) as total FROM reserves;
SELECT 'RELACIONES INSERTADAS:' as info, COUNT(*) as total FROM reserves_users;
SELECT 'RANGO DE FECHAS:' as info, MIN(reserveday) as desde, MAX(reserveday) as hasta FROM reserves;
